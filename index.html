<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FinSuite ‚Äì Back-office</title>
  <link rel="icon" href="icons/logo.svg" />
  <link rel="stylesheet" href="styles.css" />

  <!-- Google Identity Services (OAuth 2.0 para Gmail) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- jsPDF + autoTable para PDFs de facturas y resumen fiscal -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.1/dist/jspdf.plugin.autotable.min.js"></script>

  <!-- Firebase SDK (modular) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getStorage } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";
    import firebaseConfig from "./firebase-config.js";

    window.FB = {};
    FB.app = initializeApp(firebaseConfig);
    FB.auth = getAuth(FB.app);
    FB.db = getFirestore(FB.app);
    FB.storage = getStorage(FB.app);
    FB.GoogleProvider = new GoogleAuthProvider();
  </script>
</head>
<body>
  <aside class="sidebar glass">
    <div class="brand">
      <img src="icons/logo.svg" alt="logo">
      <h1>FinSuite</h1>
    </div>

    <nav>
      <button class="nav-item active" data-page="accounting">üíº Accounting</button>
      <button class="nav-item" data-page="invoicing">üßæ Invoicing</button>
      <button class="nav-item" data-page="tax">‚úÖ Tax Filing</button>
      <button class="nav-item" data-page="mail">‚úâÔ∏è Virtual Mailroom</button>
      <button class="nav-item" data-page="agent">üë§ Registered Agent</button>
    </nav>

    <div class="bottom">
      <button id="btnSettings" class="nav-item">‚öôÔ∏è Configuraci√≥n</button>

      <div class="auth glass">
        <div class="user-box">
          <img id="userPhoto" alt="">
          <div>
            <div id="userName">Invitado</div>
            <div id="userEmail" class="muted"></div>
          </div>
        </div>
        <div class="actions">
          <button id="btnGoogle" class="btn primary">Google Sign-In</button>
          <button id="btnLogout" class="btn ghost">Salir</button>
        </div>
        <div class="pin-gate">
          <input id="pinInput" type="password" placeholder="PIN (6 d√≠gitos)" maxlength="6" inputmode="numeric">
          <button id="btnPin" class="btn success">Entrar</button>
        </div>
        <small class="muted">Acceso: Google + PIN (hash)</small>
      </div>
    </div>
  </aside>

  <main>
    <header class="topbar glass">
      <div class="title">Back-office</div>
      <div class="right">
        <button id="btnGmailConnect" class="btn shine">Conectar Gmail</button>
      </div>
    </header>

    <!-- ACCOUNTING -->
    <section id="page-accounting" class="page show">
      <h2>Accounting (doble partida)</h2>

      <div class="cards">
        <div class="card glass">
          <h3>Nuevo asiento</h3>
          <form id="formTxn" class="txn">
            <div class="row">
              <input name="date" type="date" required>
              <input name="memo" placeholder="Concepto (memo)">
            </div>
            <table class="lines">
              <thead><tr><th>Cuenta</th><th>Debe</th><th>Haber</th><th></th></tr></thead>
              <tbody id="linesBody"></tbody>
            </table>
            <div class="row totals">
              <div></div>
              <div id="sumDebit">0.00</div>
              <div id="sumCredit">0.00</div>
              <div></div>
            </div>
            <div class="row">
              <button type="button" id="btnAddLine" class="btn">A√±adir l√≠nea</button>
              <button class="btn primary">Guardar asiento</button>
            </div>
          </form>
        </div>

        <div class="card glass">
          <h3>Estados</h3>
          <div id="ledgerInfo" class="stat"></div>
        </div>
      </div>

      <div class="card glass">
        <h3>Asientos recientes</h3>
        <ul id="txnList" class="list"></ul>
      </div>
    </section>

    <!-- INVOICING -->
    <section id="page-invoicing" class="page">
      <h2>Invoicing</h2>
      <form id="formInvoice" class="card glass inline">
        <input name="customer" placeholder="Cliente" required>
        <input name="email" type="email" placeholder="cliente@correo.com" required>
        <input name="concept" placeholder="Concepto" required>
        <input name="qty" type="number" step="1" value="1" required>
        <input name="price" type="number" step="0.01" placeholder="Precio unitario" required>
        <input name="due" type="date" required>
        <button class="btn success">Crear + Enviar PDF</button>
      </form>
      <ul id="invoiceList" class="list"></ul>
    </section>

    <!-- TAX -->
    <section id="page-tax" class="page">
      <h2>Tax Filing</h2>
      <div class="card glass">
        <form id="formTax" class="inline">
          <input name="ein" placeholder="EIN / RFC" required>
          <input name="year" type="number" placeholder="A√±o fiscal" required>
          <input name="income" type="number" step="0.01" placeholder="Ingresos" required>
          <input name="expenses" type="number" step="0.01" placeholder="Gastos" required>
          <button class="btn primary">Calcular + PDF</button>
        </form>
        <div id="taxResult" class="stat"></div>
      </div>
      <ul id="taxList" class="list"></ul>
    </section>

    <!-- MAIL -->
    <section id="page-mail" class="page">
      <h2>Virtual Mailroom</h2>
      <div class="card glass">
        <div class="row">
          <button id="btnFetchMail" class="btn">Leer √∫ltimos 10</button>
        </div>
        <ul id="mailList" class="list"></ul>
        <hr>
        <form id="formSendMail" class="inline">
          <input name="to" type="email" placeholder="destino@dominio.com" required>
          <input name="subject" placeholder="Asunto" required>
          <textarea name="body" placeholder="Mensaje"></textarea>
          <input name="attach" type="file">
          <button class="btn success">Enviar</button>
        </form>
      </div>
    </section>

    <!-- REGISTERED AGENT -->
    <section id="page-agent" class="page">
      <h2>Registered Agent</h2>
      <div class="card glass">
        <input id="fileAgent" type="file" />
        <button id="btnUploadAgent" class="btn">Subir</button>
        <ul id="agentFiles" class="list"></ul>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="page-settings" class="page">
      <h2>Configuraci√≥n</h2>
      <div class="card glass">
        <label>Tema</label>
        <select id="themeSelect">
          <option value="auto">Auto</option>
          <option value="dark">Oscuro</option>
          <option value="light">Claro</option>
        </select>
        <label>Color (espectro)</label>
        <input id="hueRange" type="range" min="0" max="360" value="265">
        <small class="muted">Ajusta el tono principal del glass</small>
      </div>
    </section>
  </main>

  <script src="app.js" type="module"></script>
</body>
</html>
